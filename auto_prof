import pandas_profiling
import requests
import psycopg2
import json
import pandas as pd


connection = psycopg2.connect("postgres://postgres:banana_2@localhost:5432/postgres")
connection.autocommit = True

crs = connection.cursor()

crs.execute("SELECT raw_data FROM raw LIMIT 1000000")

records = crs.fetchall()

df = pd.json_normalize(records[0])

for record in records[1:]:

    try:
        df2 = pd.json_normalize(record)
        df = df.append(df2, ignore_index=2)

    except:
        pass

report = pandas_profiling.ProfileReport(df)
report.to_file('test.html')

